<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org">
  <head>
    <title>Student Home</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <style>
      .profile-card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 20px;
        margin-bottom: 40px;
        max-width: 600px;
      }

      .profile-header {
        font-size: 24px;
        margin-bottom: 15px;
      }

      .profile-info p {
        margin: 8px 0;
        color: #444;
      }

      .edit-profile-btn {
        background-color: #764ba2;
        color: white;
        padding: 8px 16px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
      }

      .cancel-btn {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 6px 12px;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        transition: transform 0.2s ease;
      }

      .cancel-btn:hover {
        transform: translateY(-2px);
      }

      .no-sessions {
        text-align: center;
        padding: 20px;
        color: #888;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div th:replace="fragments/header :: site-header"></div>

    <main class="main-content">
      <!-- Welcome -->
      <div class="welcome-card">
        <h1 class="heading-1">Welcome, Student!</h1>
        <p>Here is your upcoming tutoring sessions.</p>
        <a th:href="@{/student/profile}" class="link">View Profile</a>
      </div>

      <!-- Upcoming Sessions -->
      <section>
        <div class="table-container">
          <h2>Upcoming Sessions</h2>
          <div th:if="${success}" class="mt-20 success-message">
            <span th:text="${success}"></span>
          </div>
          <table class="mt-20" th:if="${!upcomingSessions.isEmpty()}">
            <thead>
              <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Tutor Name</th>
                <th>Department</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="s : ${upcomingSessions}">
                <td th:text="${s.date}">2025-08-10</td>
                <td th:text="${s.timeSlot}">9:00 AM - 10:00 AM</td>
                <td>
                  <span th:text="${tutorNames[s.tutorId]}">Tutor Name</span>
                </td>
                <td>
                  <span th:text="${tutorDeptNames[s.tutorId]}">Department</span>
                </td>
                <td>
                  <form th:action="@{/student/cancel-session}" method="post">
                    <input type="hidden" name="sessionId" th:value="${s.id}" />
                    <button
                      class="delete-button size-sm"
                      type="button"
                      th:onclick="'confirmDelete(' + ${s.id} + ')'"
                    >
                      Cancel
                    </button>
                  </form>
                </td>
              </tr>
            </tbody>
          </table>
          <div class="no-sessions" th:if="${upcomingSessions.isEmpty()}">
            No upcoming sessions scheduled.
          </div>
          <a th:href="@{/student/book-session}" class="button size-sm mt-20"
            >Book New Session</a
          >
        </div>
      </section>

      <!-- Past Sessions -->
      <section style="margin-top: 3rem">
        <div class="table-container">
          <h2>Past Sessions</h2>
          <table th:if="${!pastSessions.isEmpty()}">
            <thead>
              <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Tutor Name</th>
                <th>Department</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="ps : ${pastSessions}">
                <td th:text="${ps.date}">2025-08-05</td>
                <td th:text="${ps.timeSlot}">2:00 PM - 3:00 PM</td>
                <td>
                  <span th:text="${tutorNames[ps.tutorId]}">Tutor Name</span>
                </td>
                <td>
                  <span th:text="${tutorDeptNames[ps.tutorId]}"
                    >Department</span
                  >
                </td>
              </tr>
            </tbody>
          </table>
          <div class="no-sessions" th:if="${pastSessions.isEmpty()}">
            No past sessions found.
          </div>
        </div>
      </section>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        window.confirmDelete = function (sessionId) {
          if (confirm("Are you sure you want to delete this session?")) {
            document
              .querySelector(
                `form[action='/student/cancel-session'] input[value='${sessionId}']`
              )
              .closest("form")
              .submit();
          }
        };
      });
    </script>
  </body>
</html>
